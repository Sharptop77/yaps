# yaps

Yet another ps utility

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.21+ 
- Linux —Å–∏—Å—Ç–µ–º–∞
- –î–æ—Å—Ç—É–ø –∫ `/proc` —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ 3 –∫–æ–º–∞–Ω–¥—ã
```bash
# 1. –°–∫–∞—á–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod download

# 2. –°–æ–±—Ä–∞—Ç—å
go build -o yaps yaps.go

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å
./yaps
```

## üìÅ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

### ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –û–¥–∏–Ω —Ñ–∞–π–ª `yaps.go` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–µ—Å—å –∫–æ–¥
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ 3 –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
- –ë—ã—Å—Ç—Ä–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è (~2-3 —Å–µ–∫—É–Ω–¥—ã)
- –õ–µ–≥–∫–æ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–µ–∫—Ç—ã

### ‚úÖ –ü–æ—Ä—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `yaps.go` –Ω–∞ –ª—é–±—É—é Linux –º–∞—à–∏–Ω—É
- –ù–µ –Ω—É–∂–Ω–∞ —Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### ‚úÖ –õ–µ–≥–∫–∞—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è
- –í–µ—Å—å –∫–æ–¥ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –£–¥–æ–±–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞

## üîß –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

–í–µ—Ä—Å–∏—è –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–í–°–ï** —Ñ—É–Ω–∫—Ü–∏–∏ –º–æ–¥—É–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏:

### –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ PID, PPID –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- ‚úÖ CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º (`--cpu-interval`)
- ‚úÖ –ü–∞–º—è—Ç—å –∏ swap –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç root –¥–ª—è UID 0)

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Docker, LXC, systemd –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ ID –∏ –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ Docker API
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ PID, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —Ä–µ—Å—É—Ä—Å–∞–º
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª—é–±–æ–º—É —Å—Ç–æ–ª–±—Ü—É
- ‚úÖ –†–µ—Å—É—Ä—Å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (`cpu>50`, `memory>1GB`)

### –§–æ—Ä–º–∞—Ç—ã –≤—ã–≤–æ–¥–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞, JSON, YAML
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
./yaps

# CPU –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
./yaps -c

# –†–µ—Å—É—Ä—Å—ã (CPU + –ø–∞–º—è—Ç—å + swap)
./yaps -r

# –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
./yaps --container-only --container-name
```

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã
```bash
# –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ CPU
./yaps -c --cpu-interval 500ms --sort-by cpu | head -10

# –ê–Ω–∞–ª–∏–∑ –ø–∞–º—è—Ç–∏
./yaps -m -f memory>100MB --sort-by memory

# JSON –≤—ã–≤–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
./yaps --container-only -r -o json > containers.json

# –ü—Ä–æ—Ü–µ—Å—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
./yaps --user root -r --sort-by cpu
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# –ö–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ø –ø–æ CPU
watch -n 2 './yaps -c --cpu-interval 1s --sort-by cpu | head -10'

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
while true; do
  echo "$(date): $(./yaps -c -f cpu>10 --sort-by cpu | head -5)"
  sleep 30
done
```

## üì¶ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ
```bash
# 1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª
scp yaps.go user@server:/tmp/

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–±—Ä–∞—Ç—å
ssh user@server "cd /tmp && go build -o yaps yaps.go"

# 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
ssh user@server "sudo mv /tmp/yaps /usr/local/bin/"
```

### –í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```dockerfile
FROM golang:1.21-alpine AS builder
COPY yaps.go /app/
WORKDIR /app
RUN go mod init yaps && \\
    go mod tidy && \\
    go build -o yaps yaps.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
COPY --from=builder /app/yaps /usr/local/bin/
CMD ["yaps"]
```

### –ö–∞–∫ systemd —Å–µ—Ä–≤–∏—Å (–¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —Ñ–∞–π–ª
sudo tee /etc/systemd/system/yaps.service << EOF
[Unit]
Description=Process Monitor
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/yaps --container-only -r -o json
Restart=always
User=monitoring

[Install]
WantedBy=multi-user.target
EOF

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl enable yaps
sudo systemctl start yaps
```

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```bash
# –ë—ã—Å—Ç—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è
go run yaps.go -c --pid 1-100

# –û—Ç–ª–∞–¥–∫–∞ —Å verbose –≤—ã–≤–æ–¥–æ–º
go run yaps.go -r 2>/dev/null  # —É–±—Ä–∞—Ç—å stderr
```

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
# –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å–±–æ—Ä–∫–∞
go build -ldflags "-s -w" -o yaps yaps.go

# –°–∂–∞—Ç–∏–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
upx --best yaps  # –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω UPX
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
```bash
# –° jq –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ JSON
./yaps --container-only -o json | jq '.[] | select(.cpu_percent > 10)'

# –° awk –¥–ª—è —Ç–∞–±–ª–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
./yaps -c | awk 'NR>1 && $3>5 {print $1, $3}' # PID –∏ CPU > 5%

# –° curl –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ—Ç—Ä–∏–∫
./yaps -o json | curl -X POST -d @- http://monitoring-server/metrics
```

## üìã –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

- [ ] Go 1.21+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –î–æ—Å—Ç—É–ø –∫ `/proc` —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- [ ] –ü—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ `/etc/passwd` (–¥–ª—è –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- [ ] –î–æ—Å—Ç—É–ø –∫ `/var/run/docker.sock` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –∏–º–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
- [ ] –ü—Ä–∞–≤–∞ –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤ `/usr/local/bin` (–¥–ª—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏)

## üéâ –ì–æ—Ç–æ–≤–æ!